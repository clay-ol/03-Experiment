<HTML>
<script src="https://d3js.org/d3.v4.min.js"></script>


<style>
  div {
    min-width: 400px;
    min-height: 300px;
  }

  .tree {
    border: 1px solid green;
  }

  .pie {
    border: 1px solid purple;
  }

  .bar {
    border: 1px solid brown;
  }

  svg{
    border: 3px solid hotpink;
  }
</style>

<script>
  console.log(d3); // test if d3 is loaded

  function randomData(){
    return Math.floor(Math.random() * 100)
  }
  var testData = {
    a: randomData(),
    b: randomData(),
    c: randomData(),
    d: randomData(),
    e: randomData()
  }
  var size = 5


  console.log("testData: ",testData)
  //initialize global vars like width and height
  const WIDTH = 400;
  const HEIGHT = 300;
  //x and y scaling
  var xScale = d3.scaleLinear()
    .domain([0, 100])//TODO change these values
    .range([0, WIDTH]);
  var yScale = d3.scaleLinear()
    .domain([0, 100])
    .range([0, HEIGHT]);
    
  // function(d){return xscale(d);}


  var margn = 50

  //test json data for treemap
  // var treeMapData = {"children":[{"name":"boss1","children":[{"name":"mister_a","group":"A","value":28,"colname":"level3"},{"name":"mister_b","group":"A","value":19,"colname":"level3"},{"name":"mister_c","group":"C","value":18,"colname":"level3"},{"name":"mister_d","group":"C","value":19,"colname":"level3"}],"colname":"level2"},{"name":"boss2","children":[{"name":"mister_e","group":"C","value":14,"colname":"level3"},{"name":"mister_f","group":"A","value":11,"colname":"level3"},{"name":"mister_g","group":"B","value":15,"colname":"level3"},{"name":"mister_h","group":"B","value":16,"colname":"level3"}],"colname":"level2"},{"name":"boss3","children":[{"name":"mister_i","group":"B","value":10,"colname":"level3"},{"name":"mister_j","group":"A","value":13,"colname":"level3"},{"name":"mister_k","group":"A","value":13,"colname":"level3"},{"name":"mister_l","group":"D","value":25,"colname":"level3"},{"name":"mister_m","group":"D","value":16,"colname":"level3"},{"name":"mister_n","group":"D","value":28,"colname":"level3"}],"colname":"level2"}],"name":"CEO"}
  function randomData2(){
    return Math.floor(Math.random() * 100) % 20
  }
  var treeMapData = {
    "children":[
    {
      "name":"boss1",
      "children":[
        {
          "name":"mister_a",
          "value":randomData2(),
          "colname":"level3"
        },
        {
          "name":"mister_b",
          "value":randomData2(),
          "colname":"level3"
        },
        {
          "name":"mister_c",
          "value":randomData2(),
          "colname":"level3"
        },
        {
          "name":"mister_d",
          "value":randomData2(),
          "colname":"level3"
        }
      ],
      "colname":"level2"
    },
    {
      "name":"boss2",
      "children":[
        {
          "name":"mister_e",
          "value":randomData2(),
          "colname":"level3"
        },
        {
          "name":"mister_f",
          "value":randomData2(),
          "colname":"level3"
        },
        {
          "name":"mister_g",
          "value":randomData2(),
          "colname":"level3"
        },
        {
          "name":"mister_h",
          "value":randomData2(),
          "colname":"level3"
        }
      ],
      "colname":"level2"
    },
    {
      "name":"boss3",
      "children":[
        {
          "name":"mister_i",
          "value":randomData2(),
          "colname":"level3"
        },
        {
          "name":"mister_j",
          "value":randomData2(),
          "colname":"level3"
        },
        {
          "name":"mister_k",
          "value":randomData2(),
          "colname":"level3"
        }
      ],
      "colname":"level2"
    }
  ],
  "name":"CEO"
}

  // iterations = 0
      function randomTwoKeys(){

        letters = Object.keys(testData)
        key1 = letters[Math.floor(Math.random() * letters.length)]
        key2 = letters[Math.floor(Math.random() * letters.length)]
        // if keys are equal, run again
        // added iteration count to prevent statistically improbable chance that method runs forever
        while( key1 === key2 ){
          randomTwoKeys()
          // iterations++
          // if( iterations > 5){
          //   iterations = 0
          //   break;
          // }
        }
        return [key1, key2];
      }

      function pieMaker(){
      randomTwo = randomTwoKeys()
      // console.log(randomTwo)
      console.log("#holder")
      var svg_pie = d3.select("#holder")
        .append("svg")
        .attr("width", WIDTH)
        .attr("height", HEIGHT)
        .append("g")
        .attr("transform", "translate(" + WIDTH / 2 + "," + HEIGHT / 2 + ")");

      var radius = HEIGHT / 2 - 10 // add margin to prevent clipping

      var pie = d3.pie()
        .value(function (d) { return d.value; })
      var pieData = pie(d3.entries(testData))

      var pieDataTest = pie(d3.entries(testData))[1]
      // console.log( pieDataTest)

      var arcMaker = d3.arc()
        .innerRadius(50)
        .outerRadius(radius)
      svg_pie
        .selectAll('data')
        .data(pieData)
        .enter()
        .append('path')
        .attr('d', arcMaker)
        .attr("fill", "white")
        .attr("stroke", "black")
        .style("stroke-width", "2px")

      svg_pie
        .selectAll('data')
        .data(pieData)
        .enter()
        .append('circle')
        .attr('r', function(d){
          if(randomTwo.includes(d.data.key)){
            return 5
          }
          else{
            return 0
          }
        })
        .attr("transform", function (d) { return "translate(" + arcMaker.centroid(d) + ")"; })
        var ratio = 100
        // find actual ratio between two points
        // console.log( testData[randomTwo[0]] )
        if( randomTwo[0] >= randomTwo[1]){
          ratio = (testData[randomTwo[0]] / testData[randomTwo[1]]) * 100
        }
        else{
          ratio =  (testData[randomTwo[1]] / testData[randomTwo[0]] ) * 100
        }
      }
      vises = ["tree", "pie", "bar", "Tree", "pie","bar"]
      pieMaker()
</script>

<body>
  <div id="experiment">
<div id="holder">
</div>
    <form id="form_submit">
      <input type="submit" value="submit">
    </form>
  </div>
  <h1> Hunter Experiment </h1>
  <div id="tree">
  <script>
    //points to mark
    iterations = 0
    randomTwo = randomTwoKeys()
    console.log("Marked Treeplot Points: ",randomTwo)
    //add svg to tree div
    var svg_tree = d3.select('#tree')
      .append("svg")
      .attr("width",WIDTH)
      .attr("height",HEIGHT)
      .append("g");
      // .attr("transform", "translate(" + WIDTH / 2 + "," + HEIGHT / 2 + ")");

    var root = d3.hierarchy(treeMapData).sum(function(d){ return d.value});
    // var root = d3.hierarchy(testData).sum(function(d){ return d.value});

    console.log("ROOT:")
    console.log(root)

    var tree = d3.treemap()
      .size([WIDTH,HEIGHT])
      .padding(2)
      (root)
    
    svg_tree.selectAll("rect")
      .data(root.leaves())
      .enter()
      .append("rect")
      .attr('x', function (d) { console.log(d.data.name,": x: ",d.x0," y: ",d.y0); return d.x0; })
      .attr('y', function (d) { return d.y0; })
      .attr('width', function (d) { return d.x1 - d.x0; })
      .attr('height', function (d) { return d.y1 - d.y0; })
      .style("stroke", "black")
      .style("fill", "slateblue")

    // svg_tree.selectAll("text")
    //   .data(root.leaves())
    //   .enter()
    //   .append("text")
    //     .attr("x", function(d){ return d.x0+5})    // +10 to adjust position (more right)
    //     .attr("y", function(d){ return d.y0+20})    // +20 to adjust position (lower)
    //     .text(function(d){ return d.data.name })
    //     .attr("font-size", "15px")
    //     .attr("fill", "white")

  </script>
  </div>

  
  <h1> Clay Experiment</h1>
  <div id="pie">
    <script>
      randomTwo = randomTwoKeys()
      // console.log(randomTwo)
      var svg_pie = d3.select("#pie")
        .append("svg")
        .attr("width", WIDTH)
        .attr("height", HEIGHT)
        .append("g")
        .attr("transform", "translate(" + WIDTH / 2 + "," + HEIGHT / 2 + ")");

      var radius = HEIGHT / 2 - 10 // add margin to prevent clipping

      var pie = d3.pie()
        .value(function (d) { return d.value; })
      var pieData = pie(d3.entries(testData))

      var pieDataTest = pie(d3.entries(testData))[1]
      // console.log( pieDataTest)

      var arcMaker = d3.arc()
        .innerRadius(50)
        .outerRadius(radius)
      svg_pie
        .selectAll('data')
        .data(pieData)
        .enter()
        .append('path')
        .attr('d', arcMaker)
        .attr("fill", "white")
        .attr("stroke", "black")
        .style("stroke-width", "2px")

      svg_pie
        .selectAll('data')
        .data(pieData)
        .enter()
        .append('circle')
        .attr('r', function(d){
          if(randomTwo.includes(d.data.key)){
            return 5
          }
          else{
            return 0
          }
        })
        .attr("transform", function (d) { return "translate(" + arcMaker.centroid(d) + ")"; })
        var ratio = 100
        // find actual ratio between two points
        // console.log( testData[randomTwo[0]] )
        if( randomTwo[0] >= randomTwo[1]){
          ratio = (testData[randomTwo[0]] / testData[randomTwo[1]]) * 100
        }
        else{
          ratio =  (testData[randomTwo[1]] / testData[randomTwo[0]] ) * 100
        }
        // console.log(ratio)

    </script>
    <form id="pie_submit">
      <label for="pie_input">Enter ratio between the two points.</label>
    <input type="text" id = "pie_input">
</form>
  </div>
  <h1> Nick Experiment</h1>
  <div id="bar">
    <script>
      // add svg for bar chart
      var testData2 = [34, 10, 22, 54, 49]
      var svgbar = d3.select("#bar")
      .append("svg")
      .attr("width", WIDTH)
      .attr("height", HEIGHT)
      .append("g").attr("transform", "translate(" + margn/2 + "," + (HEIGHT - margn/2) + ")");

      // add X axis
      var xBand = d3.scaleBand()
      .range([0, WIDTH])
      // .domain(testData.map(function(d) { return d.value; }));
      .domain([145, 500]);
      svgbar.append("g")
      .call(d3.axisBottom(xBand));

      // add Y axis
      svgbar.append("g")
      .attr("transform", "translate(0," + (-1*HEIGHT) + ")")
      .call(d3.axisLeft(yScale));

      // add bars
      svgbar.selectAll("mybar")
      .data(testData2)
      .enter().append("rect")
      .attr("x", function(d, i) { return (i*size) + margn; })
      .attr("y", function(d, i) { return HEIGHT/2 - (d*10); })
      .attr("width", "40")
      .attr("height", HEIGHT)
      .attr("fill", "brown");


    </script>
  </div>

</body>
</HTML>